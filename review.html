<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PulseScope Â· Code Review</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700&family=Syne:wght@400;700;800&display=swap');

  :root {
    --bg: #080c14;
    --panel: #0d1420;
    --border: #1a2840;
    --accent: #00d4ff;
    --accent2: #ff4d6d;
    --accent3: #39ff14;
    --warn: #ffb800;
    --text: #c8d8f0;
    --dim: #4a6080;
    --bug: #ff4d6d;
    --perf: #ffb800;
    --feat: #39ff14;
    --info: #00d4ff;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Syne', sans-serif;
    min-height: 100vh;
    padding: 40px 20px;
  }

  .grid-bg {
    position: fixed; inset: 0; z-index: 0;
    background-image:
      linear-gradient(rgba(0,212,255,0.03) 1px, transparent 1px),
      linear-gradient(90deg, rgba(0,212,255,0.03) 1px, transparent 1px);
    background-size: 40px 40px;
    pointer-events: none;
  }

  .container { max-width: 960px; margin: 0 auto; position: relative; z-index: 1; }

  /* HEADER */
  header { margin-bottom: 48px; }
  .header-tag {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--accent);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 12px;
    opacity: 0.7;
  }
  h1 {
    font-size: clamp(36px, 6vw, 64px);
    font-weight: 800;
    line-height: 1;
    background: linear-gradient(135deg, #fff 0%, var(--accent) 60%, #0088aa 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: 16px;
  }
  .subtitle { color: var(--dim); font-size: 14px; font-family: 'JetBrains Mono', monospace; }

  /* SCORE ROW */
  .score-row {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    margin-bottom: 48px;
  }
  .score-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 20px;
    text-align: center;
    position: relative;
    overflow: hidden;
    transition: transform 0.2s, border-color 0.2s;
    cursor: default;
  }
  .score-card:hover { transform: translateY(-2px); }
  .score-card::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0;
    height: 2px;
  }
  .score-card.bugs::before { background: var(--bug); }
  .score-card.perf::before { background: var(--perf); }
  .score-card.quality::before { background: var(--info); }
  .score-card.security::before { background: var(--feat); }
  .score-card:hover.bugs { border-color: var(--bug); }
  .score-card:hover.perf { border-color: var(--perf); }
  .score-card:hover.quality { border-color: var(--info); }
  .score-card:hover.security { border-color: var(--feat); }
  .score-num {
    font-size: 48px;
    font-weight: 800;
    line-height: 1;
    margin-bottom: 4px;
  }
  .bugs .score-num { color: var(--bug); }
  .perf .score-num { color: var(--perf); }
  .quality .score-num { color: var(--info); }
  .security .score-num { color: var(--feat); }
  .score-label { font-size: 11px; color: var(--dim); text-transform: uppercase; letter-spacing: 2px; font-family: 'JetBrains Mono', monospace; }

  /* SECTION */
  .section { margin-bottom: 40px; }
  .section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 1px solid var(--border);
  }
  .section-dot { width: 8px; height: 8px; border-radius: 50%; flex-shrink: 0; }
  .section-title { font-size: 13px; font-weight: 700; text-transform: uppercase; letter-spacing: 3px; font-family: 'JetBrains Mono', monospace; }

  /* ISSUE CARD */
  .issue-list { display: flex; flex-direction: column; gap: 12px; }
  .issue-card {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 10px;
    overflow: hidden;
    transition: border-color 0.2s;
  }
  .issue-card:hover { border-color: #2a3a55; }
  .issue-header {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 14px 18px;
    cursor: pointer;
    user-select: none;
  }
  .issue-badge {
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    font-weight: 700;
    padding: 3px 8px;
    border-radius: 4px;
    text-transform: uppercase;
    letter-spacing: 1px;
    flex-shrink: 0;
  }
  .badge-bug { background: rgba(255,77,109,0.15); color: var(--bug); border: 1px solid rgba(255,77,109,0.3); }
  .badge-warn { background: rgba(255,184,0,0.15); color: var(--warn); border: 1px solid rgba(255,184,0,0.3); }
  .badge-ok { background: rgba(0,212,255,0.1); color: var(--info); border: 1px solid rgba(0,212,255,0.2); }
  .badge-feat { background: rgba(57,255,20,0.1); color: var(--feat); border: 1px solid rgba(57,255,20,0.2); }
  .issue-title { flex: 1; font-size: 14px; color: #e0ecff; }
  .issue-file {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--dim);
    flex-shrink: 0;
  }
  .chevron { color: var(--dim); font-size: 18px; transition: transform 0.2s; flex-shrink: 0; }
  .issue-card.open .chevron { transform: rotate(90deg); }
  .issue-body {
    display: none;
    padding: 0 18px 16px;
    border-top: 1px solid var(--border);
    margin-top: 0;
  }
  .issue-card.open .issue-body { display: block; }
  .issue-desc {
    font-size: 13px;
    color: #8aa0c0;
    line-height: 1.7;
    margin-top: 12px;
    margin-bottom: 12px;
  }
  .code-block {
    background: #06090f;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 14px 16px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 12px;
    line-height: 1.6;
    overflow-x: auto;
    margin-top: 10px;
  }
  .code-block .bad { color: var(--bug); }
  .code-block .good { color: var(--feat); }
  .code-block .comment { color: var(--dim); }
  .fix-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--dim);
    text-transform: uppercase;
    letter-spacing: 2px;
    margin-top: 14px;
    margin-bottom: 6px;
  }

  /* FEATURE TABLE */
  .feat-table { width: 100%; border-collapse: collapse; }
  .feat-table th {
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    color: var(--dim);
    text-transform: uppercase;
    letter-spacing: 2px;
    text-align: left;
    padding: 8px 14px;
    border-bottom: 1px solid var(--border);
  }
  .feat-table td { padding: 12px 14px; border-bottom: 1px solid rgba(26,40,64,0.5); font-size: 13px; vertical-align: top; }
  .feat-table tr:last-child td { border-bottom: none; }
  .feat-table tr:hover td { background: rgba(255,255,255,0.02); }
  .priority { font-family: 'JetBrains Mono', monospace; font-size: 12px; font-weight: 700; }
  .p-high { color: var(--bug); }
  .p-med { color: var(--warn); }
  .p-low { color: var(--feat); }
  .feat-desc { color: #8aa0c0; font-size: 12px; margin-top: 4px; }

  /* STACK EVAL */
  .stack-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
  .stack-item {
    background: var(--panel);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 14px 16px;
    display: flex;
    align-items: flex-start;
    gap: 12px;
  }
  .stack-icon { font-size: 20px; flex-shrink: 0; margin-top: 2px; }
  .stack-name { font-weight: 700; font-size: 13px; color: #e0ecff; margin-bottom: 4px; }
  .stack-verdict { font-size: 12px; color: #8aa0c0; line-height: 1.5; }
  .verdict-tag {
    display: inline-block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 10px;
    padding: 2px 6px;
    border-radius: 3px;
    margin-bottom: 6px;
    font-weight: 700;
  }
  .v-good { background: rgba(57,255,20,0.1); color: var(--feat); border: 1px solid rgba(57,255,20,0.2); }
  .v-warn { background: rgba(255,184,0,0.15); color: var(--warn); border: 1px solid rgba(255,184,0,0.3); }

  @media (max-width: 600px) {
    .score-row { grid-template-columns: repeat(2, 1fr); }
    .stack-grid { grid-template-columns: 1fr; }
  }
</style>
</head>
<body>
<div class="grid-bg"></div>
<div class="container">

  <header>
    <div class="header-tag">// Code Review Report Â· 2026.02</div>
    <h1>PulseScope</h1>
    <div class="subtitle">main.go &amp; App.tsx Â· è¦†ç›–èŒƒå›´ï¼šBug Â· æ€§èƒ½ Â· ä»£ç è´¨é‡ Â· å®‰å…¨</div>
  </header>

  <!-- SCORES -->
  <div class="score-row">
    <div class="score-card bugs">
      <div class="score-num">4</div>
      <div class="score-label">Bugs Found</div>
    </div>
    <div class="score-card perf">
      <div class="score-num">2</div>
      <div class="score-label">Perf Issues</div>
    </div>
    <div class="score-card quality">
      <div class="score-num">3</div>
      <div class="score-label">Quality Tips</div>
    </div>
    <div class="score-card security">
      <div class="score-num">2</div>
      <div class="score-label">Security Notes</div>
    </div>
  </div>

  <!-- TECH STACK -->
  <div class="section">
    <div class="section-header">
      <div class="section-dot" style="background:var(--info)"></div>
      <div class="section-title" style="color:var(--info)">æŠ€æœ¯æ ˆè¯„ä¼°</div>
    </div>
    <div class="stack-grid">
      <div class="stack-item">
        <div class="stack-icon">âš™ï¸</div>
        <div>
          <div class="verdict-tag v-good">âœ“ åˆç†</div>
          <div class="stack-name">C++ â†’ /dev/shm â†’ Go</div>
          <div class="stack-verdict">IPC æ¶æ„é€‰å‹ä¼˜ç§€ã€‚å…±äº«å†…å­˜å»¶è¿Ÿæ¥è¿‘é›¶ï¼ŒGo æ¡¥æ¥ WebSocket é«˜å¹¶å‘å¤„ç†èƒ½åŠ›å¼ºï¼Œè§£è€¦è®¾è®¡ä¹Ÿåšå¾—å¥½ã€‚</div>
        </div>
      </div>
      <div class="stack-item">
        <div class="stack-icon">âš›ï¸</div>
        <div>
          <div class="verdict-tag v-good">âœ“ ä¸»æµ</div>
          <div class="stack-name">React + TypeScript + Vite + Tailwind</div>
          <div class="stack-verdict">å‰ç«¯é»„é‡‘ç»„åˆï¼Œæ²¡æœ‰é—®é¢˜ã€‚ç±»å‹å®šä¹‰ï¼ˆtype.tsï¼‰æŠ½ç¦»ä¹Ÿæ˜¯å¥½ä¹ æƒ¯ã€‚</div>
        </div>
      </div>
      <div class="stack-item">
        <div class="stack-icon">ğŸŒ</div>
        <div>
          <div class="verdict-tag v-good">âœ“ åˆé€‚</div>
          <div class="stack-name">gorilla/websocket</div>
          <div class="stack-verdict">æˆç†Ÿç¨³å®šï¼Œ25Hz æ¨é€å¯¹ WebSocket æ¥è¯´ç»°ç»°æœ‰ä½™ï¼Œä¸éœ€è¦æ¢åº“ã€‚</div>
        </div>
      </div>
      <div class="stack-item">
        <div class="stack-icon">âš ï¸</div>
        <div>
          <div class="verdict-tag v-warn">âš  æ³¨æ„</div>
          <div class="stack-name">ç›®å½•ç»“æ„æ··ä¹±</div>
          <div class="stack-verdict">æ ¹ç›®å½•æœ‰ App.tsx / index.tsxï¼Œåˆæœ‰ frontend/ ç›®å½•ï¼Œè¿˜æäº¤äº† .vite/depsã€‚å»ºè®®ç»Ÿä¸€åˆ° frontend/src/ ä¸‹ï¼Œ.vite åŠ å…¥ .gitignoreã€‚</div>
        </div>
      </div>
    </div>
  </div>

  <!-- BUGS -->
  <div class="section">
    <div class="section-header">
      <div class="section-dot" style="background:var(--bug)"></div>
      <div class="section-title" style="color:var(--bug)">Bug & æ­£ç¡®æ€§</div>
    </div>
    <div class="issue-list">

      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-bug">ä¸¥é‡</span>
          <span class="issue-title">SHM æ•°æ®ç«äº‰ â€” è¯»å†™æ— åŒæ­¥</span>
          <span class="issue-file">main.go:75</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            Go ç«¯æ¯ 40ms ç›´æ¥è¯» <code>header.JsonOffset / JsonSize</code>ï¼ŒåŒæ—¶ C++ ç«¯å¯èƒ½æ­£åœ¨å†™å…¥ã€‚åœ¨å¤šæ ¸ç¯å¢ƒä¸‹ï¼ŒGo å¯èƒ½è¯»åˆ°æ—§ offset ä½†æ–° sizeï¼ˆæˆ–åä¹‹ï¼‰ï¼Œå¯¼è‡´è§£æåˆ°æŸåçš„ JSONï¼Œç”šè‡³è¶Šç•Œè®¿é—®å†…å­˜ã€‚è¿™æ˜¯æœ€é«˜é£é™©çš„ bugã€‚
          </div>
          <div class="fix-label">å»ºè®®ä¿®å¤</div>
          <div class="code-block">
<span class="comment">// C++ ç«¯åº”ä½¿ç”¨åŒç¼“å†²æˆ– sequence lock</span>
<span class="comment">// Go ç«¯è¯»å–å‰å…ˆæ£€æŸ¥ magic number ç‰ˆæœ¬å·æ˜¯å¦å˜åŒ–</span>
<span class="bad">// âŒ å½“å‰ï¼šç›´æ¥è¯»ï¼Œæ— ä»»ä½•ä¿æŠ¤</span>
jsonOffset := header.JsonOffset
jsonSize   := header.JsonSize

<span class="good">// âœ… æœ€ç®€å•çš„ç¼“è§£ï¼šè¯»ä¸¤æ¬¡ï¼Œæ¯”è¾ƒæ˜¯å¦ä¸€è‡´</span>
jsonOffset1 := header.JsonOffset
jsonSize1   := header.JsonSize
runtime.Gosched() <span class="comment">// è®©å‡º CPUï¼Œç»™ C++ å®Œæˆå†™å…¥</span>
jsonOffset2 := header.JsonOffset
jsonSize2   := header.JsonSize
if jsonOffset1 != jsonOffset2 || jsonSize1 != jsonSize2 {
    continue <span class="comment">// è·³è¿‡è¿™å¸§ï¼Œä¸‹å¸§å†è¯»</span>
}
          </div>
        </div>
      </div>

      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-bug">ä¸¥é‡</span>
          <span class="issue-title">SHM è¶Šç•Œè®¿é—® â€” jsonOffset æœªéªŒè¯ä¸Šç•Œ</span>
          <span class="issue-file">main.go:83</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            ä»£ç åªæ£€æŸ¥äº† <code>jsonSize &lt; 10000</code>ï¼Œä½†æ²¡æœ‰éªŒè¯ <code>jsonOffset + jsonSize</code> æ˜¯å¦è¶…å‡ºæ•´ä¸ª SHM æ˜ å°„å¤§å°ï¼ˆ10MBï¼‰ã€‚å¦‚æœ C++ ç«¯å†™å…¥äº†å¼‚å¸¸å€¼ï¼ŒGo ç«¯ä¼šç›´æ¥ panicï¼ˆindex out of rangeï¼‰å¯¼è‡´åç«¯å´©æºƒã€‚
          </div>
          <div class="fix-label">å»ºè®®ä¿®å¤</div>
          <div class="code-block">
<span class="bad">// âŒ å½“å‰</span>
if jsonSize > 0 && jsonSize < 10000 && jsonOffset > 0 {
    jsonBytes := data[jsonOffset : jsonOffset+jsonSize]

<span class="good">// âœ… ä¿®å¤ï¼šéªŒè¯å®Œæ•´è¾¹ç•Œ</span>
const shmTotalSize = 10 * 1024 * 1024
if jsonSize > 0 && jsonSize < 65536 &&
   jsonOffset > 0 &&
   jsonOffset+jsonSize <= uint64(shmTotalSize) {
    jsonBytes := data[jsonOffset : jsonOffset+jsonSize]
          </div>
        </div>
      </div>

      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-bug">ä¸­ç­‰</span>
          <span class="issue-title">goroutine æ³„æ¼ â€” ReadMessage goroutine æ— æ³•é€€å‡º</span>
          <span class="issue-file">main.go:57</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            ä¸»å¾ªç¯é€šè¿‡ <code>conn.WriteJSON</code> å¤±è´¥æ¥æ„ŸçŸ¥æ–­å¼€å¹¶é€€å‡ºï¼Œä½† <code>go func()</code> ä¸­çš„ ReadMessage goroutine ä¼šåœ¨ä¸»å¾ªç¯é€€å‡ºåç»§ç»­é˜»å¡ï¼Œç›´åˆ°åº•å±‚ TCP è¿æ¥å½»åº•å…³é—­ã€‚åœ¨é«˜é¢‘è¿æ¥/æ–­å¼€åœºæ™¯ä¸‹ï¼Œgoroutine å¯èƒ½ç´¯ç§¯ã€‚
          </div>
          <div class="fix-label">å»ºè®®ä¿®å¤</div>
          <div class="code-block">
<span class="good">// âœ… ä½¿ç”¨ context æ§åˆ¶ goroutine ç”Ÿå‘½å‘¨æœŸ</span>
ctx, cancel := context.WithCancel(context.Background())
defer cancel()

go func() {
    defer cancel()
    for {
        select {
        case &lt;-ctx.Done():
            return
        default:
            _, message, err := conn.ReadMessage()
            if err != nil { return }
            <span class="comment">// ... handle message</span>
        }
    }
}()
          </div>
        </div>
      </div>

      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-warn">ä½</span>
          <span class="issue-title">App.tsxï¼šESDF åœ°å›¾æ¨¡æ‹Ÿæ•°æ®ä¾èµ– mapData.grid å¼•å‘æ— é™é‡æ¸²</span>
          <span class="issue-file">App.tsx:46</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            <code>useEffect</code> çš„ä¾èµ–æ•°ç»„æ˜¯ <code>[mapData.grid]</code>ï¼Œä½†æ¯æ¬¡ setMapData éƒ½åˆ›å»ºæ–°æ•°ç»„ï¼Œå¯¼è‡´æ¯æ¬¡æ›´æ–°éƒ½ä¼šé‡æ–°æ³¨å†Œ intervalï¼Œé€ æˆä¸å¿…è¦çš„ cleanup/setup å¾ªç¯ã€‚è¿™ä¸ä¼šå´©æºƒï¼Œä½†ä¼šæµªè´¹èµ„æºã€‚
          </div>
          <div class="fix-label">å»ºè®®ä¿®å¤</div>
          <div class="code-block">
<span class="bad">// âŒ å½“å‰ï¼šä¾èµ– mapData.grid å¯¼è‡´å¾ªç¯</span>
useEffect(() => {
    const interval = setInterval(() => { ... }, 100);
    return () => clearInterval(interval);
}, [mapData.grid]);

<span class="good">// âœ… ç§»é™¤ä¾èµ–ï¼ŒåªæŒ‚è½½ä¸€æ¬¡</span>
useEffect(() => {
    const interval = setInterval(() => {
        const now = Date.now();
        setMapData(prev => ({
            ...prev,
            grid: prev.grid.map((_, i) => { ... })
        }));
    }, 100);
    return () => clearInterval(interval);
}, []); <span class="comment">// ç©ºä¾èµ–æ•°ç»„</span>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- PERFORMANCE -->
  <div class="section">
    <div class="section-header">
      <div class="section-dot" style="background:var(--warn)"></div>
      <div class="section-title" style="color:var(--warn)">æ€§èƒ½é—®é¢˜</div>
    </div>
    <div class="issue-list">

      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-warn">æ€§èƒ½</span>
          <span class="issue-title">ESDF åœ°å›¾æ¯ 100ms å…¨é‡é‡ç®— 10000 ä¸ªæ ¼å­</span>
          <span class="issue-file">App.tsx:39</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            å½“å‰æ¨¡æ‹Ÿé€»è¾‘æ¯å¸§å¯¹ 10000 ä¸ªå…ƒç´ åšä¸¤æ¬¡ <code>Math.sqrt</code>ï¼Œå…± 20000 æ¬¡æµ®ç‚¹è¿ç®—ã€‚è™½ç„¶ç›®å‰æ˜¯æ¨¡æ‹Ÿæ•°æ®é—®é¢˜ä¸å¤§ï¼Œä½†å½“ä½ æ¥å…¥çœŸå® ESDF æ•°æ®æ—¶ï¼Œå¦‚æœå‰ç«¯ä»åšæ­¤ç±»è¿ç®—ä¼šé€ æˆä¸»çº¿ç¨‹å¡é¡¿ã€‚åº”å°†è®¡ç®—è¿ç§»åˆ° Web Worker æˆ–ç›´æ¥åœ¨ Go ç«¯é¢„å¤„ç†åæ¨é€ã€‚
          </div>
          <div class="fix-label">å»ºè®®æ–¹å‘</div>
          <div class="code-block">
<span class="comment">// æ–¹æ¡ˆAï¼šWeb Workerï¼ˆä¸é˜»å¡ä¸»çº¿ç¨‹ï¼‰</span>
<span class="comment">// æ–¹æ¡ˆBï¼ˆæ¨èï¼‰ï¼šGo åç«¯ç›´æ¥æ¨é€ ESDF float32 æ•°ç»„</span>
<span class="comment">// SHM ä¸­çš„ EsdfMap[10000] å·²ç»å‡†å¤‡å¥½äº†ï¼Œç›´æ¥è¯»å–å³å¯</span>
<span class="good">// Go ç«¯ï¼šç›´æ¥è¯» header.EsdfMap åˆ‡ç‰‡å¹¶åºåˆ—åŒ–å‘é€</span>
esdfSlice := (*[10000]float32)(unsafe.Pointer(&amp;header.EsdfMap))
payload["esdf"] = esdfSlice[:]
          </div>
        </div>
      </div>

      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-warn">æ€§èƒ½</span>
          <span class="issue-title">Go æœªè®¾ç½® WebSocket å†™è¶…æ—¶ï¼Œæ…¢å®¢æˆ·ç«¯ä¼šé˜»å¡ ticker</span>
          <span class="issue-file">main.go:96</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            å¦‚æœå‰ç«¯å¤„ç†æ…¢ï¼ˆé¡µé¢åå°ã€ç½‘ç»œæŠ–åŠ¨ï¼‰ï¼Œ<code>conn.WriteJSON</code> ä¼šé˜»å¡ï¼Œå¯¼è‡´ä¸‹ä¸€ä¸ª ticker äº‹ä»¶ç§¯å‹ï¼Œæ•°æ®æ¨é€èŠ‚å¥è¢«æ‰“ä¹±ã€‚
          </div>
          <div class="fix-label">å»ºè®®ä¿®å¤</div>
          <div class="code-block">
<span class="good">// æ¯æ¬¡å†™å…¥å‰è®¾ç½® deadline</span>
conn.SetWriteDeadline(time.Now().Add(2 * time.Second))
if err := conn.WriteJSON(payload); err != nil {
    break
}
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- SECURITY -->
  <div class="section">
    <div class="section-header">
      <div class="section-dot" style="background:var(--feat)"></div>
      <div class="section-title" style="color:var(--feat)">å®‰å…¨æ€§</div>
    </div>
    <div class="issue-list">

      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-bug">æ³¨æ„</span>
          <span class="issue-title">WebSocket å…è®¸ä»»æ„æ¥æºï¼ˆCheckOrigin æ’è¿”å› trueï¼‰</span>
          <span class="issue-file">main.go:18</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            å½“å‰ <code>CheckOrigin</code> ç›´æ¥è¿”å› trueï¼Œä»»ä½•æ¥æºçš„ç½‘é¡µéƒ½å¯ä»¥è¿æ¥åˆ°åç«¯ã€‚åœ¨å†…ç½‘åµŒå…¥å¼è®¾å¤‡ä¸Šï¼Œè¿™æ„å‘³ç€å±€åŸŸç½‘å†…ä»»ä½•äººæ‰“å¼€æ¶æ„ç½‘é¡µéƒ½èƒ½å‘ä½ çš„æœºå™¨äººå†™å…¥ PID å‚æ•°ã€‚è¿™åœ¨æ¯”èµ›/å®éªŒå®¤ç¯å¢ƒä¸­æ˜¯çœŸå®é£é™©ã€‚
          </div>
          <div class="fix-label">å»ºè®®ä¿®å¤</div>
          <div class="code-block">
<span class="bad">// âŒ å½“å‰ï¼šä»»æ„æ¥æº</span>
CheckOrigin: func(r *http.Request) bool { return true }

<span class="good">// âœ… é™åˆ¶åªå…è®¸æœ¬æœºæ¥æº</span>
CheckOrigin: func(r *http.Request) bool {
    origin := r.Header.Get("Origin")
    return origin == "http://localhost:3000" ||
           origin == "http://127.0.0.1:3000"
},
          </div>
        </div>
      </div>

      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-warn">æ³¨æ„</span>
          <span class="issue-title">å‰ç«¯ç›´æ¥å†™ SHMï¼ˆé€šè¿‡ WebSocketï¼‰ï¼Œæ— å‚æ•°èŒƒå›´æ ¡éªŒ</span>
          <span class="issue-file">main.go:61</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            å‰ç«¯å‘æ¥çš„ PID å€¼ç›´æ¥å†™å…¥å…±äº«å†…å­˜ï¼Œæ²¡æœ‰ä»»ä½•èŒƒå›´æ£€æŸ¥ã€‚å¦‚æœå‰ç«¯ bug æˆ–æ¶æ„è¾“å…¥å‘é€äº† <code>pid_p: 99999</code>ï¼ŒC++ ä¼šç›´æ¥ä½¿ç”¨ï¼Œå¯èƒ½å¯¼è‡´ç”µæœºå¤±æ§ã€‚å¯¹äºæœºå™¨äººæ§åˆ¶ç³»ç»Ÿï¼Œå‚æ•°å†™å…¥å¿…é¡»æœ‰å®‰å…¨è¾¹ç•Œã€‚
          </div>
          <div class="fix-label">å»ºè®®ä¿®å¤</div>
          <div class="code-block">
<span class="good">// âœ… æœåŠ¡ç«¯åšå‚æ•°èŒƒå›´é’³åˆ¶</span>
func clamp(v, min, max float32) float32 {
    if v &lt; min { return min }
    if v > max { return max }
    return v
}

if v, ok := update["pid_p"]; ok {
    header.PidP = clamp(v, 0.0, 10.0)
}
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- QUALITY -->
  <div class="section">
    <div class="section-header">
      <div class="section-dot" style="background:var(--info)"></div>
      <div class="section-title" style="color:var(--info)">ä»£ç è´¨é‡</div>
    </div>
    <div class="issue-list">
      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-ok">è´¨é‡</span>
          <span class="issue-title">main.go å…¨éƒ¨é€»è¾‘å †åœ¨ä¸€ä¸ªå‡½æ•°ï¼Œåº”æ‹†åˆ†</span>
          <span class="issue-file">main.go</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            æ•´ä¸ª main.go åªæœ‰ä¸€ä¸ª main å‡½æ•°ï¼ŒSHM æŒ‚è½½ã€WebSocket handlerã€æ•°æ®è¯»å–ã€å‚æ•°å†™å…¥å…¨éƒ¨æ··åœ¨ä¸€èµ·ã€‚å»ºè®®æ‹†åˆ†æˆ <code>openSHM()</code>ã€<code>handleWebSocket()</code>ã€<code>readSeries()</code>ã€<code>applyParams()</code> å‡ ä¸ªå‡½æ•°ï¼Œæ–¹ä¾¿æµ‹è¯•å’Œç»´æŠ¤ã€‚
          </div>
        </div>
      </div>
      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-ok">è´¨é‡</span>
          <span class="issue-title">App.tsx ä¸­çŠ¶æ€ status æ˜¯ç¡¬ç¼–ç å‡æ•°æ®</span>
          <span class="issue-file">App.tsx:33</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            <code>backendConnected: true, shmActive: true, nucCpuLoad: 12</code> éƒ½æ˜¯å†™æ­»çš„å‡å€¼ï¼Œä¸ä¼šåæ˜ çœŸå®çŠ¶æ€ã€‚Vision "210 FPS" ä¹Ÿæ˜¯ç¡¬ç¼–ç å­—ç¬¦ä¸²ã€‚è¿™äº›åº”è¯¥ä» WebSocket æ¶ˆæ¯ä¸­åŠ¨æ€æ›´æ–°ã€‚
          </div>
        </div>
      </div>
      <div class="issue-card" onclick="toggle(this)">
        <div class="issue-header">
          <span class="issue-badge badge-ok">è´¨é‡</span>
          <span class="issue-title">App.tsx å­˜åœ¨ä¹±ç æ³¨é‡Šï¼ˆç¼–ç é—®é¢˜ï¼‰</span>
          <span class="issue-file">App.tsx:73,83</span>
          <span class="chevron">â€º</span>
        </div>
        <div class="issue-body">
          <div class="issue-desc">
            ä»£ç ä¸­å­˜åœ¨ <code>// Ã©Â»ËœÃ¨Â®Â¤Ã©Å¡Ã¨â€”Ã¨Â§â€ Ã©Â¢'</code> è¿™æ ·çš„ä¹±ç ï¼Œæ˜¯ä¸­æ–‡æ³¨é‡Šè¢«é”™è¯¯ç¼–ç å¯¼è‡´çš„ã€‚æ£€æŸ¥ç¼–è¾‘å™¨/Git çš„æ–‡ä»¶ç¼–ç è®¾ç½®ï¼Œç¡®ä¿ç»Ÿä¸€ä¸º UTF-8 without BOMã€‚å»ºè®®è‹±æ–‡æˆ–æ­£å¸¸ä¸­æ–‡æ³¨é‡Šï¼Œé¿å…æ··ç”¨ã€‚
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FEATURES -->
  <div class="section">
    <div class="section-header">
      <div class="section-dot" style="background:var(--feat)"></div>
      <div class="section-title" style="color:var(--feat)">æ–°åŠŸèƒ½å»ºè®®</div>
    </div>
    <div style="background:var(--panel);border:1px solid var(--border);border-radius:10px;overflow:hidden;">
      <table class="feat-table">
        <thead>
          <tr>
            <th>ä¼˜å…ˆçº§</th>
            <th>åŠŸèƒ½</th>
            <th>ä»·å€¼</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="priority p-high">ğŸ”´ é«˜</span></td>
            <td>
              <strong>æ•°æ®å½•åˆ¶ & å›æ”¾</strong>
              <div class="feat-desc">Go ç«¯å°† SHM æ•°æ®æµå†™å…¥ .jsonl æ–‡ä»¶ï¼Œå‰ç«¯æ”¯æŒåŠ è½½å›æ”¾ã€‚å¯¹åµŒå…¥å¼è°ƒè¯•æå…¶æœ‰ç”¨ï¼Œæ— éœ€æœºå™¨åœ¨åœºå°±èƒ½å¤ç°é—®é¢˜ã€‚</div>
            </td>
            <td style="color:#8aa0c0;font-size:12px;">è°ƒè¯•æ•ˆç‡ â†‘â†‘</td>
          </tr>
          <tr>
            <td><span class="priority p-high">ğŸ”´ é«˜</span></td>
            <td>
              <strong>å‘Šè­¦é˜ˆå€¼ç³»ç»Ÿ</strong>
              <div class="feat-desc">åœ¨å‰ç«¯ä¸ºæ¯ä¸ª series é…ç½® min/max é˜ˆå€¼ï¼Œè¶…é™æ—¶å›¾è¡¨é«˜äº® + console å‘Šè­¦ã€‚å½“å‰ status ç¡¬ç¼–ç é—®é¢˜ä¹Ÿä¸€å¹¶è§£å†³ã€‚</div>
            </td>
            <td style="color:#8aa0c0;font-size:12px;">å¯é æ€§ â†‘â†‘</td>
          </tr>
          <tr>
            <td><span class="priority p-med">ğŸŸ¡ ä¸­</span></td>
            <td>
              <strong>çœŸå® ESDF æ•°æ®æ¥å…¥</strong>
              <div class="feat-desc">SHM struct é‡Œå·²æœ‰ EsdfMap[10000]ï¼ŒGo ç«¯ç›´æ¥è¯»å–å¹¶æ¨é€åˆ°å‰ç«¯ï¼Œæ›¿æ¢æ‰å½“å‰çš„çº¯æ¨¡æ‹Ÿè®¡ç®—ã€‚</div>
            </td>
            <td style="color:#8aa0c0;font-size:12px;">åŠŸèƒ½å®Œæ•´æ€§</td>
          </tr>
          <tr>
            <td><span class="priority p-med">ğŸŸ¡ ä¸­</span></td>
            <td>
              <strong>æ–­çº¿è‡ªåŠ¨é‡è¿</strong>
              <div class="feat-desc">å‰ç«¯ WebSocket æ–­çº¿ååº”æŒ‡æ•°é€€é¿é‡è¿ï¼ˆ1s â†’ 2s â†’ 4s...ï¼‰ï¼Œè€Œéè®©ç”¨æˆ·æ‰‹åŠ¨åˆ·æ–°ã€‚å½“å‰ backendConnected çŠ¶æ€ä¹Ÿæ˜¯å‡çš„ï¼Œéœ€çœŸå®æ£€æµ‹ã€‚</div>
            </td>
            <td style="color:#8aa0c0;font-size:12px;">å¥å£®æ€§ â†‘</td>
          </tr>
          <tr>
            <td><span class="priority p-low">ğŸŸ¢ ä½</span></td>
            <td>
              <strong>æ•°æ®å¯¼å‡º CSV</strong>
              <div class="feat-desc">å‰ç«¯ä¿ç•™æœ€è¿‘ N å¸§æ•°æ®ï¼Œä¸€é”®å¯¼å‡º CSV ä¾› Python/Matlab åˆ†æã€‚</div>
            </td>
            <td style="color:#8aa0c0;font-size:12px;">åˆ†æä¾¿åˆ©æ€§</td>
          </tr>
          <tr>
            <td><span class="priority p-low">ğŸŸ¢ ä½</span></td>
            <td>
              <strong>å¤šè®¾å¤‡æ”¯æŒ</strong>
              <div class="feat-desc">Go åç«¯æ”¯æŒè¿æ¥å¤šä¸ªä¸åŒè·¯å¾„çš„ SHMï¼ˆå¦‚ vision_debug_shm_1ã€_2ï¼‰ï¼Œå‰ç«¯ç”¨ Tab åˆ‡æ¢ã€‚</div>
            </td>
            <td style="color:#8aa0c0;font-size:12px;">æ‰©å±•æ€§</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
function toggle(card) {
  card.classList.toggle('open');
}
</script>
</body>
</html>